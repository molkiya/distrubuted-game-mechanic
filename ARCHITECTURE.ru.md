# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

> [üá¨üáß English version](ARCHITECTURE.md)

## –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–ú—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è edge-–≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏–≥—Ä–æ–≤–æ–π –±—ç–∫–µ–Ω–¥**, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–µ–π–º–ø–ª–µ–π –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ø—Å–µ–≤–¥–æ—Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ seed. –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:

- **React Frontend**: –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π UI, –ø–æ–¥–∫–ª—é—á–∞—é—â–∏–π—Å—è –∫ tick-broadcaster —á–µ—Ä–µ–∑ WebSocket
- **Cloudflare Workers Edge Gateway**: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ –±–ª–∏–∂–∞–π—à–µ–º—É —Ä–µ–≥–∏–æ–Ω—É tick-broadcaster
- **AWS Lambda Tick Broadcaster**: –ú—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–∏–∫—Ä–æ–±—ç–∫–µ–Ω–¥—ã, —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É—é—â–∏–µ –∏–≥—Ä–æ–≤—ã–µ —Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–∞–º
- **Go Backend Services**: Stateless-—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **DynamoDB/Cassandra**: –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å–µ—Å—Å–∏–π –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

–ö–ª—é—á–µ–≤–∞—è –∏–Ω–Ω–æ–≤–∞—Ü–∏—è ‚Äî **—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Ç–∏–∫–æ–≤ —á–µ—Ä–µ–∑ Lambda-–º–∏–∫—Ä–æ–±—ç–∫–µ–Ω–¥—ã**: –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ç–∏–∫–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ Lambda-—Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã—á–∏—Å–ª—è—é—Ç –∏ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É—é—Ç —Ç–∏–∫–∏ –±–ª–∏–∂–∞–π—à–∏–º –∏–≥—Ä–æ–∫–∞–º —á–µ—Ä–µ–∑ WebSocket, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–µ–π–º–ø–ª–µ–π —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∑–∞–¥–µ—Ä–∂–∫–∏.

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –ø—è—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–ª–æ—ë–≤:

1. **Frontend (React)**: –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π UI, –ø–æ–¥–∫–ª—é—á–∞—é—â–∏–π—Å—è –∫ WebSocket tick-broadcaster –∏ –ø–æ–ª—É—á–∞—é—â–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∏–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

2. **Edge Gateway (Cloudflare Workers)**: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É —Ä–µ–≥–∏–æ–Ω—É tick-broadcaster –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏/–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π.

3. **Tick Broadcaster (AWS Lambda)**: –ú—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–∏–∫—Ä–æ–±—ç–∫–µ–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ:
   - –†–∞–±–æ—Ç–∞—é—Ç –≤ 8+ —Ä–µ–≥–∏–æ–Ω–∞—Ö AWS –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É
   - –í—ã—á–∏—Å–ª—è—é—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
   - –¢—Ä–∞–Ω—Å–ª–∏—Ä—É—é—Ç —Ç–∏–∫–∏ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–º –∏–≥—Ä–æ–∫–∞–º —á–µ—Ä–µ–∑ WebSocket
   - –ò–∑–º–µ—Ä—è—é—Ç –∑–∞–¥–µ—Ä–∂–∫—É –∏–≥—Ä–æ–∫–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - –û—Ç–∫–ª—é—á–∞—é—Ç –∏–≥—Ä–æ–∫–æ–≤ —Å –ø–ª–æ—Ö–∏–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º

4. **Go Backend Services (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**: Stateless HTTP-—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

5. **–°–ª–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è**: DynamoDB –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è Lambda, Cassandra –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö**: 
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Edge Gateway ‚Üí Tick Broadcaster (–±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω) ‚Üí WebSocket ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                                       ‚Üì
                                   DynamoDB (—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–π/—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
```

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```mermaid
graph TB
    subgraph "–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π"
        User[–ë—Ä–∞—É–∑–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
        React[React Frontend<br/>WebSocket –∫–ª–∏–µ–Ω—Ç<br/>–ú–æ–Ω–∏—Ç–æ—Ä –∑–∞–¥–µ—Ä–∂–∫–∏]
    end
    
    subgraph "Edge —Å–ª–æ–π"
        Edge[Cloudflare Worker<br/>Edge Gateway<br/>- –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞<br/>- –ö—ç—à —Å–µ—Å—Å–∏–π]
    end
    
    subgraph "–°–ª–æ–π Tick Broadcaster (AWS Lambda)"
        US[Lambda us-east-1<br/>Tick Broadcaster<br/>WebSocket API]
        EU[Lambda eu-west-1<br/>Tick Broadcaster<br/>WebSocket API]
        ASIA[Lambda ap-northeast-1<br/>Tick Broadcaster<br/>WebSocket API]
    end
    
    subgraph "–°–ª–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è"
        DynamoDB[(DynamoDB<br/>- –°–µ—Å—Å–∏–∏<br/>- –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è<br/>- –î–∞–Ω–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏)]
    end
    
    User -->|HTTPS| React
    React -->|POST /edge/game/start| Edge
    
    Edge -->|–°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é| US
    Edge -->|–°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é| EU
    Edge -->|–°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é| ASIA
    
    React <-->|WebSocket| US
    React <-->|WebSocket| EU
    React <-->|WebSocket| ASIA
    
    US -->|–ß—Ç–µ–Ω–∏–µ/–ó–∞–ø–∏—Å—å| DynamoDB
    EU -->|–ß—Ç–µ–Ω–∏–µ/–ó–∞–ø–∏—Å—å| DynamoDB
    ASIA -->|–ß—Ç–µ–Ω–∏–µ/–ó–∞–ø–∏—Å—å| DynamoDB
```

---

## –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏?

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ–º—ã–µ —Å–µ—Ä–≤–µ—Ä–æ–º —Ç–∏–∫–∏ —Ç—Ä–µ–±—É—é—Ç –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è —á–µ—Å—Ç–Ω–æ–≥–æ –≥–µ–π–º–ø–ª–µ—è:

- **–í—Å–µ –∏–≥—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∞—Ç—å —Ç–∏–∫–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è**
- **–ò–≥—Ä–æ–∫–∏ —Å –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤–∏–¥—è—Ç —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã**
- **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞—é—Ç –∑–∞–∏–∫–∞–Ω–∏—è –∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `MAX_LATENCY_MS` | 150–º—Å | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ RTT –¥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è |
| `MAX_JITTER_MS` | 50–º—Å | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–∂–∏—Ç—Ç–µ—Ä (—Å—Ç–∞–Ω–¥. –æ—Ç–∫–ª.) –¥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è |
| `WARNING_LATENCY_MS` | 100–º—Å | –ü–æ—Ä–æ–≥ RTT –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è |
| `WARNING_JITTER_MS` | 30–º—Å | –ü–æ—Ä–æ–≥ –¥–∂–∏—Ç—Ç–µ—Ä–∞ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è |
| `LATENCY_SAMPLES` | 5 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π –¥–ª—è —Å–∫–æ–ª—å–∑—è—â–µ–≥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ |

### –ü–æ—Ç–æ–∫ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏

```mermaid
sequenceDiagram
    participant C as –ö–ª–∏–µ–Ω—Ç
    participant L as Lambda
    
    loop –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        C->>L: {action: "ping", clientTimestamp: T1}
        L-->>C: {type: "pong", clientTimestamp: T1, serverTimestamp: T2}
        Note over C: RTT = —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è - T1<br/>–î–æ–±–∞–≤–∏—Ç—å –≤ –≤—ã–±–æ—Ä–∫—É
        Note over C: –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω–µ–µ + –¥–∂–∏—Ç—Ç–µ—Ä
    end
    
    alt RTT > 100–º—Å –ò–õ–ò –î–∂–∏—Ç—Ç–µ—Ä > 30–º—Å
        L-->>C: {type: "latency_status", status: "warning"}
    end
    
    alt RTT > 150–º—Å –ò–õ–ò –î–∂–∏—Ç—Ç–µ—Ä > 50–º—Å
        L-->>C: {type: "kicked", reason: "..."}
        L->>C: –ó–∞–∫—Ä—ã—Ç—å WebSocket
    end
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞

```
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ  ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                           ‚îÇ
                                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    –≤—Ö–æ–¥ –≤ —Å–µ—Å—Å–∏—é   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –æ—Ç–∫–ª—é—á—ë–Ω    ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   –≥–æ—Ç–æ–≤      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñ≤                                   ‚îÇ
       ‚îÇ                                   ‚ñº
       ‚îÇ         –∫–∏–∫ (–≤—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞) ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   –≤ –∏–≥—Ä–µ     ‚îÇ
                                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –†–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ —Ä–µ–≥–∏–æ–Ω—ã

| –†–µ–≥–∏–æ–Ω | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|--------|--------------|---------------|
| us-east-1 | –°–µ–≤–µ—Ä–Ω–∞—è –í–∏—Ä–¥–∂–∏–Ω–∏—è | –ê–º–µ—Ä–∏–∫–∞ |
| us-west-2 | –û—Ä–µ–≥–æ–Ω | –ó–∞–ø–∞–¥–Ω–æ–µ –ø–æ–±–µ—Ä–µ–∂—å–µ –°–®–ê |
| eu-west-1 | –ò—Ä–ª–∞–Ω–¥–∏—è | –ï–≤—Ä–æ–ø–∞ |
| eu-central-1 | –§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ï–≤—Ä–æ–ø–∞ |
| ap-northeast-1 | –¢–æ–∫–∏–æ | –í–æ—Å—Ç–æ—á–Ω–∞—è –ê–∑–∏—è |
| ap-southeast-1 | –°–∏–Ω–≥–∞–ø—É—Ä | –Æ–≥–æ-–í–æ—Å—Ç–æ—á–Ω–∞—è –ê–∑–∏—è |
| ap-south-1 | –ú—É–º–±–∞–∏ | –Æ–∂–Ω–∞—è –ê–∑–∏—è |
| sa-east-1 | –°–∞–Ω-–ü–∞—É–ª—É | –Æ–∂–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞ |

---

## –ü–æ—Ç–æ–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ—Ç–æ–∫ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã

1. **–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "Start Game" –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

2. **Frontend ‚Üí Edge**: Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /edge/game/start`:
   ```json
   {
     "userId": "user123",
     "preferredRegion": "eu-west-1"
   }
   ```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ Edge Gateway**:
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω tick-broadcaster
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: preferredRegion ‚Üí –∑–∞–≥–æ–ª–æ–≤–æ–∫ x-user-region ‚Üí –ì–µ–æ (—Å—Ç—Ä–∞–Ω–∞ CF) ‚Üí –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

4. **Edge ‚Üí Tick Broadcaster**: –°–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é —á–µ—Ä–µ–∑ HTTP:
   ```
   POST https://xxx.execute-api.eu-west-1.amazonaws.com/prod/sessions
   ```

5. **Lambda ‚Üí DynamoDB**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Å—Å–∏–∏

6. **–¶–µ–ø–æ—á–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤**:
   - Lambda ‚Üí Edge: –î–µ—Ç–∞–ª–∏ —Å–µ—Å—Å–∏–∏ + WebSocket endpoint
   - Edge ‚Üí Frontend: –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å wsEndpoint

7. **Frontend ‚Üí Lambda WebSocket**:
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `wss://xxx.execute-api.eu-west-1.amazonaws.com/prod`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
   - –ù–∞—á–∏–Ω–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ —Ç–∏–∫–æ–≤

### –ü–æ—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ —Ç–∏–∫–æ–≤

Tick broadcaster –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —Ü–∏–∫–ª:

   ```typescript
while (running) {
  const now = Date.now();
  
  for (const session of activeSessions) {
    // –í—ã—á–∏—Å–ª–∏—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    const state = stateAt(session.seed, session.startAt, session.tickMs, now);
    
    // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
    const connections = await getConnectionsBySession(session.sessionId);
    
    // –¢—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–∫ –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
    await broadcastToConnections(connections, {
      type: 'tick',
      step: state.step,
      value: state.value,
      round: state.round,
      broken: state.broken,
      serverTimestamp: now,
    });
  }
  
  // –ñ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–∏–∫–∞
  await sleep(tickMs);
}
```

---

## –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫

–î–≤–∏–∂–æ–∫ –∏–¥–µ–Ω—Ç–∏—á–µ–Ω –≤–æ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö Lambda, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

```typescript
function stateAt(seed: number, startAt: number, tickMs: number, now: number): State {
  const step = Math.floor((now - startAt) / tickMs);
  
  // –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ç —à–∞–≥–∞ 0 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
  let value = 0, round = 0, broken = false;
  let stepsUntilBreak = computeBreakInterval(seed, round);
  let stepsSinceBreak = 0;
  
  for (let i = 0; i <= step; i++) {
    broken = false;
    stepsSinceBreak++;
    
    if (stepsSinceBreak >= stepsUntilBreak) {
      broken = true;
      round++;
      value = 0;
      stepsUntilBreak = computeBreakInterval(seed, round);
      stepsSinceBreak = 0;
  } else {
      value++;
    }
  }
  
  return { step, value, round, broken };
}
```

**–ö–ª—é—á–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞**:
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –û–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è**: –í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã Lambda –≤—ã—á–∏—Å–ª—è—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–∏–∫ –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∑–∞–¥–µ—Ä–∂–∫–∏)

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ vs —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ç–∏–∫–∏

| –ê—Å–ø–µ–∫—Ç | –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ (—Å—Ç–∞—Ä–æ–µ) | –°–µ—Ä–≤–µ—Ä–Ω—ã–µ (–Ω–æ–≤–æ–µ) |
|--------|---------------------|-------------------|
| **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ç–∏–∫–æ–≤** | –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ | Lambda –≤—ã—á–∏—Å–ª—è–µ—Ç –∏ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç |
| **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** | –ö–ª–∏–µ–Ω—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ | –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–∏–∫ |
| **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏** | –î–∞ (–Ω–µ—Ç —Å–µ—Ç–∏ –¥–ª—è —Ç–∏–∫–æ–≤) | –ù–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞) |
| **–ß–µ—Å—Ç–Ω–∞—è –∏–≥—Ä–∞** | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ | –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º |
| **–ó–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Ç–æ–≤** | –ù–∏–∑–∫–∞—è (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞) | –í—ã—Å–æ–∫–∞—è (–∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä) |
| **–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** | –¢–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ | –ù–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–π –∏–≥—Ä—ã |
| **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥** | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è | –£–º–µ—Ä–µ–Ω–Ω–∞—è (WebSocket + —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏) |

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥

**–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Ç–∏–∫–∏**:
- –û–¥–Ω–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–≥—Ä—ã
- –°—Ä–µ–¥—ã —Å –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –≠–∫–æ–Ω–æ–º–Ω—ã–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

**–°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ç–∏–∫–∏ (Lambda)**:
- –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–≥—Ä—ã, —Ç—Ä–µ–±—É—é—â–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –°–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∏–≥—Ä—ã, —Ç—Ä–µ–±—É—é—â–∏–µ —á–µ—Å—Ç–Ω–æ–π –∏–≥—Ä—ã
- –ò–≥—Ä—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π AWS CLI
- Node.js 18+
- Serverless Framework 3.x
- Cloudflare Workers (wrangler)

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Tick Broadcaster

```bash
cd tick-broadcaster
npm install
npm run build
npm run deploy:all  # –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤–æ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö
```

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Edge Gateway

```bash
cd edge
npm install
npm run deploy
```

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Frontend

```bash
cd frontend
npm install
npm run build
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ (Vercel, Netlify, S3 –∏ —Ç.–¥.)
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**Tick Broadcaster**:
```yaml
MAX_LATENCY_MS: 150
MAX_JITTER_MS: 50
WARNING_LATENCY_MS: 100
WARNING_JITTER_MS: 30
DEFAULT_TICK_MS: 100
COUNTDOWN_MS: 3000
```

**Edge Gateway**:
```yaml
TICK_US_HTTP: https://xxx.execute-api.us-east-1.amazonaws.com/prod
TICK_US_WS: wss://xxx.execute-api.us-east-1.amazonaws.com/prod
TICK_EU_HTTP: https://xxx.execute-api.eu-west-1.amazonaws.com/prod
TICK_EU_WS: wss://xxx.execute-api.eu-west-1.amazonaws.com/prod
USE_TICK_BROADCASTER: true
```

---

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **Provisioned Concurrency**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ö–æ–ª–æ–¥–Ω—ã—Ö —Å—Ç–∞—Ä—Ç–æ–≤ Lambda
2. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã DynamoDB**: –ú–µ–∂—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π
3. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Ç–∏–∫–æ–≤**: –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ —á–∞—Å—Ç–æ—Ç—ã —Ç–∏–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–≥—Ä–æ–∫–æ–≤
4. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–æ–≤**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∑–∞–¥–µ—Ä–∂–∫–µ –¥–ª—è –±–æ–ª–µ–µ —á–µ—Å—Ç–Ω—ã—Ö –º–∞—Ç—á–µ–π
5. **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω–≤–µ–π–µ—Ä**: –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å–æ–±—ã—Ç–∏–π –≤ Kinesis –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
6. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤**: –ó–∞–ø–∏—Å—å –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏–≥—Ä –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç–∏–∫–æ–≤
