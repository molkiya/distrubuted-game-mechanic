# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

> [üá¨üáß English version](ARCHITECTURE.md)

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å–µ—Å—Å–∏–π —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –≤—ã—á–∏—Å–ª—è—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–µ–∑ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å –±—ç–∫–µ–Ω–¥–æ–º.

## –û—Å–Ω–æ–≤–Ω–∞—è –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –î–≤–∏–∂–æ–∫

### –§—É–Ω–∫—Ü–∏—è –î–≤–∏–∂–∫–∞

–°–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã ‚Äî —ç—Ç–æ —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è:

```go
func StateAt(seed int64, startAt time.Time, tickMs int64, now time.Time) State
```

**–í—Ö–æ–¥—ã:**
- `seed`: –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ seed, –∫–æ—Ç–æ—Ä–æ–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–∑—Ä—ã–≤–æ–≤
- `startAt`: –ö–æ–≥–¥–∞ —Å–µ—Å—Å–∏—è –Ω–∞—á–∞–ª–∞—Å—å (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏)
- `tickMs`: –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ç–∏–∫–æ–≤ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
- `now`: –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–í—ã—Ö–æ–¥:**
- `State` —Å:
  - `Step`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–æ–≤ —Å –Ω–∞—á–∞–ª–∞
  - `Value`: –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ)
  - `Round`: –ù–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞ (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä—ã–≤–∞)
  - `Broken`: –†–∞–∑–æ—Ä–≤–∞–Ω–∞ –ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–±—Ä–æ—à–µ–Ω–∞)

### –ì–∞—Ä–∞–Ω—Ç–∏—è –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞

**–ö–ª—é—á–µ–≤–æ–µ –°–≤–æ–π—Å—Ç–≤–æ**: –ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö `(seed, startAt, tickMs, now)`, —Ñ—É–Ω–∫—Ü–∏—è **–≤—Å–µ–≥–¥–∞** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `State`.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–µ—Å—Å–∏–∏ –≤–∏–¥—è—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–µ—Ç–µ–≤–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–æ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è, –ø—Ä–æ—à–ª–æ–µ –∏–ª–∏ –±—É–¥—É—â–µ–µ

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –®–∞–≥–∞**:
   ```
   step = floor((now - startAt) / tickMs)
   ```
   –ï—Å–ª–∏ `now < startAt`, step = 0 (–¥–æ –Ω–∞—á–∞–ª–∞).

2. **–ü–∞—Ç—Ç–µ—Ä–Ω –†–∞–∑—Ä—ã–≤–æ–≤**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç xorshift64 PRNG –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ä–∞–∑—Ä—ã–≤–∞: 100-300 —à–∞–≥–æ–≤ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞ —Ä–∞—É–Ω–¥)
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–≤–æ–¥–∏—Ç—Å—è –∏–∑ `(seed, round)` ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—Ö–æ–¥–æ–≤

3. **–°–∏–º—É–ª—è—Ü–∏—è –°–æ—Å—Ç–æ—è–Ω–∏—è**:
   - –°–∏–º—É–ª–∏—Ä—É–µ—Ç –æ—Ç —à–∞–≥–∞ 0 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ä–∞–∑—Ä—ã–≤—ã
   - –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ: `Round++`, `Value = 0`, `Broken = true`
   - –ü–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞: –∑–Ω–∞—á–µ–Ω–∏–µ —Å–Ω–æ–≤–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

### –ü—Ä–∏–º–µ—Ä

```
–°–µ—Å—Å–∏—è: seed=12345, startAt=10:00:00, tickMs=100

–í—Ä–µ–º—è: 10:00:00.000 ‚Üí –®–∞–≥: 0,  –ó–Ω–∞—á–µ–Ω–∏–µ: 1,  –†–∞—É–Ω–¥: 0, Broken: false
–í—Ä–µ–º—è: 10:00:00.100 ‚Üí –®–∞–≥: 1,  –ó–Ω–∞—á–µ–Ω–∏–µ: 2,  –†–∞—É–Ω–¥: 0, Broken: false
–í—Ä–µ–º—è: 10:00:00.200 ‚Üí –®–∞–≥: 2,  –ó–Ω–∞—á–µ–Ω–∏–µ: 3,  –†–∞—É–Ω–¥: 0, Broken: false
...
–í—Ä–µ–º—è: 10:00:15.000 ‚Üí –®–∞–≥: 150, –ó–Ω–∞—á–µ–Ω–∏–µ: 0, –†–∞—É–Ω–¥: 1, Broken: true  (–ø—Ä–æ–∏–∑–æ—à—ë–ª —Ä–∞–∑—Ä—ã–≤)
–í—Ä–µ–º—è: 10:00:15.100 ‚Üí –®–∞–≥: 151, –ó–Ω–∞—á–µ–Ω–∏–µ: 1, –†–∞—É–Ω–¥: 1, Broken: false
```

–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º seed –≤–∏–¥—è—Ç —Ä–∞–∑—Ä—ã–≤ –Ω–∞ —à–∞–≥–µ 150, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∏.

## –ü–æ—á–µ–º—É –≠—Ç–æ—Ç –î–∏–∑–∞–π–Ω –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º

### 1. –ù–µ –¢—Ä–µ–±—É–µ—Ç—Å—è –°—Ç—Ä–∏–º–∏–Ω–≥ –°–æ—Å—Ç–æ—è–Ω–∏—è

**–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –ü–æ–¥—Ö–æ–¥:**
- –ë—ç–∫–µ–Ω–¥ —Å—Ç—Ä–∏–º–∏—Ç –∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º
- 10,000 —Å–µ—Å—Å–∏–π √ó 10 —Ç–∏–∫–æ–≤/—Å–µ–∫—É–Ω–¥—É = 100,000 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É
- –¢—Ä–µ–±—É—é—Ç—Å—è WebSocket/SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥

**–≠—Ç–æ—Ç –î–∏–∑–∞–π–Ω:**
- –ë—ç–∫–µ–Ω–¥ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Å—Å–∏–∏ (seed, startAt, tickMs)
- –ö–ª–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- **–ù–æ–ª—å** –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å –±—ç–∫–µ–Ω–¥–æ–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥ —Å–Ω–∏–∂–µ–Ω–∞ –Ω–∞ –ø–æ—Ä—è–¥–∫–∏

### 2. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å Edge/–£–∑–ª–æ–≤

**–õ—é–±–æ–π edge —É–∑–µ–ª –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**

```
Edge –£–∑–µ–ª A (EU):
  state = StateAt(seed, startAt, tickMs, now)
  ‚Üí –¢–æ –∂–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ –∏ —É –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ —É–∑–ª–∞

Edge –£–∑–µ–ª B (US):
  state = StateAt(seed, startAt, tickMs, now)
  ‚Üí –¢–æ –∂–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ –∏ —É –£–∑–ª–∞ A

–ö–ª–∏–µ–Ω—Ç (–ë—Ä–∞—É–∑–µ—Ä):
  state = StateAt(seed, startAt, tickMs, now)
  ‚Üí –¢–æ –∂–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ –∏ —É –≤—Å–µ—Ö —É–∑–ª–æ–≤
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Edge —É–∑–ª—ã –º–æ–≥—É—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ö–ª–∏–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ñ–ª–∞–π–Ω (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏)
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

### 3. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –•—Ä–∞–Ω–µ–Ω–∏—è

**–ß—Ç–æ –ú—ã –•—Ä–∞–Ω–∏–º:**
- ID —Å–µ—Å—Å–∏–∏
- Seed (UUID –∏–ª–∏ uint64)
- –í—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞
- –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ç–∏–∫–æ–≤
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –°—Ç–∞—Ç—É—Å (running/stopped)

**–ß—Ç–æ –ú—ã –ù–ï –•—Ä–∞–Ω–∏–º:**
- ‚ùå –ö–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –∑–Ω–∞—á–µ–Ω–∏–π
- ‚ùå –°–æ–±—ã—Ç–∏—è —Ä–∞–∑—Ä—ã–≤–æ–≤
- ‚ùå –°–Ω–∏–º–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –•—Ä–∞–Ω–µ–Ω–∏—é:**
- –ù–∞ —Å–µ—Å—Å–∏—é: ~200 –±–∞–π—Ç (vs. –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ú–ë –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —à–∫–∞–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è)
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–µ—Å—Å–∏–π
- –ù–µ—Ç —Ä–æ—Å—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

### 4. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ë—ç–∫–µ–Ω–¥ –°–µ—Ä–≤–∏—Å—ã:**
- Stateless HTTP —Å–µ—Ä–≤–∏—Å—ã
- –ú–æ–≥—É—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ (–¥–æ–±–∞–≤–ª—è—Ç—å –±–æ–ª—å—à–µ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
- –ù–µ—Ç –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
- Redis (—Ç–µ–∫—É—â–µ–µ): –ë—ã—Å—Ç—Ä–æ–µ, –ø—Ä–æ—Å—Ç–æ–µ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TTL
- Cassandra (–±—É–¥—É—â–µ–µ): –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ, —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ, –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏
- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**Edge –°–ª–æ–π:**
- –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ CDN edge (Cloudflare Workers –∏ —Ç.–¥.)
- –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±—ç–∫–µ–Ω–¥–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –°–Ω–∏–∂–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –∏ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±—ç–∫–µ–Ω–¥

## –°–ª–æ–∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –°–ª–æ–π –ö–ª–∏–µ–Ω—Ç–∞                   ‚îÇ
‚îÇ  - –í—ã—á–∏—Å–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É—è engine.StateAt ‚îÇ
‚îÇ  - –ù–µ—Ç –≤—ã–∑–æ–≤–æ–≤ –±—ç–∫–µ–Ω–¥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚Üë
                  ‚îÇ (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏)
                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –°–ª–æ–π API                       ‚îÇ
‚îÇ  - POST /v1/sessions (—Å–æ–∑–¥–∞—Ç—å)           ‚îÇ
‚îÇ  - GET /v1/sessions/{id} (–ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥)  ‚îÇ
‚îÇ  - POST /v1/sessions/{id}/stop          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚Üë
                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –°–ª–æ–π –•—Ä–∞–Ω–µ–Ω–∏—è                   ‚îÇ
‚îÇ  - Redis: —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π   ‚îÇ
‚îÇ  - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å –±—ç–∫–µ–Ω–¥—ã  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –î–µ—Ç–∞–ª–∏ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –î–≤–∏–∂–∫–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ü—Å–µ–≤–¥–æ—Å–ª—É—á–∞–π–Ω—ã—Ö –ß–∏—Å–µ–ª

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **xorshift64** –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏:

```go
func xorshift64(state uint64) uint64 {
    state ^= state << 13
    state ^= state >> 7
    state ^= state << 17
    return state
}
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–æ: O(1) –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—Ö–æ–¥ ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—ã—Ö–æ–¥
- –•–æ—Ä–æ—à–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞
- –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ò–Ω—Ç–µ—Ä–≤–∞–ª–∞ –†–∞–∑—Ä—ã–≤–∞

```go
func computeBreakInterval(seed int64, round int64) int64 {
    combined := seed ^ round
    rng := xorshift64(uint64(combined))
    interval := 100 + int64(rng % 201)  // –î–∏–∞–ø–∞–∑–æ–Ω: [100, 300]
    return interval
}
```

**–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º:**
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ `(seed, round)` ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
- –†–∞–∑–Ω—ã–µ —Ä–∞—É–Ω–¥—ã ‚Üí —Ä–∞–∑–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (–≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 100-300)
- –°–æ–∑–¥–∞—ë—Ç –ø—Å–µ–≤–¥–æ—Å–ª—É—á–∞–π–Ω—ã–π, –Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–∑—Ä—ã–≤–æ–≤

### –ü–æ—Ç–æ–∫ –í—ã—á–∏—Å–ª–µ–Ω–∏—è –°–æ—Å—Ç–æ—è–Ω–∏—è

```
–í—Ö–æ–¥: (seed, startAt, tickMs, now)
  ‚Üì
–í—ã—á–∏—Å–ª–∏—Ç—å: step = floor((now - startAt) / tickMs)
  ‚Üì
–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ç —à–∞–≥–∞ 0 –¥–æ —à–∞–≥–∞:
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã –∑–Ω–∞—á–µ–Ω–∏—è
  - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑—Ä—ã–≤—ã (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞)
  - –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ: —Å–±—Ä–æ—Å–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—É–Ω–¥
  ‚Üì
–í—ã—Ö–æ–¥: State{Step, Value, Round, Broken}
```

## –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ù–æ–≤—ã—Ö –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ü–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–î–≤–∏–∂–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω –Ω–æ–≤—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏:

```go
// –ü—Ä–∏–º–µ—Ä: –†–∞–∑–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä—ã–≤–∞
func StateAtWithProbability(seed int64, startAt time.Time, tickMs int64, now time.Time, breakProb float64) State {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–∑—Ä—ã–≤–∞
}
```

### –ó–∞–º–µ–Ω–∞ –ë—ç–∫–µ–Ω–¥–∞ –•—Ä–∞–Ω–µ–Ω–∏—è

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Store` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å:

```go
// –¢–µ–∫—É—â–µ–µ: Redis
store := store.NewRedisStore(ttl)

// –ë—É–¥—É—â–µ–µ: Cassandra
store := store.NewCassandraStore(config)

// –ë—É–¥—É—â–µ–µ: PostgreSQL
store := store.NewPostgresStore(config)
```

–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –∏–ª–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ.

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Edge

–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ edge:

```typescript
// –ü—Ä–∏–º–µ—Ä Cloudflare Worker
import { StateAt } from './engine';

const state = StateAt(seed, startAt, tickMs, Date.now());
// –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–∑–æ–≤ –±—ç–∫–µ–Ω–¥–∞
```

## –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –°–ª–æ–∂–Ω–æ—Å—Ç—å –í—ã—á–∏—Å–ª–µ–Ω–∏—è

- **StateAt**: O(step) - —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –æ—Ç 0 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –î–ª—è –±–æ–ª—å—à–∏—Ö —à–∞–≥–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É–ª—É –≤–º–µ—Å—Ç–æ —Å–∏–º—É–ª—è—Ü–∏–∏
- **–¢–∏–ø–∏—á–Ω—ã–π —Å–ª—É—á–∞–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –®–∞–≥–∏ < 10,000 ‚Üí < 1ms –≤—Ä–µ–º—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

### –°–ª–æ–∂–Ω–æ—Å—Ç—å –•—Ä–∞–Ω–µ–Ω–∏—è

- **Create**: O(1) - –æ–¥–∏–Ω Redis SET
- **Get**: O(1) - –æ–¥–∏–Ω Redis GET
- **Update**: O(1) - –æ–¥–∏–Ω Redis SET
- **–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ**: O(n) –≥–¥–µ n = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π

### –ü—Ä–µ–¥–µ–ª—ã –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

- **–°–µ—Å—Å–∏–∏**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã —ë–º–∫–æ—Å—Ç—å—é —Ö—Ä–∞–Ω–µ–Ω–∏—è (Redis/Cassandra)
- **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ CPU (–Ω–æ –∫–ª–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç, –Ω–µ –±—ç–∫–µ–Ω–¥)
- **API –∑–∞–ø—Ä–æ—Å—ã**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã —ë–º–∫–æ—Å—Ç—å—é HTTP —Å–µ—Ä–≤–µ—Ä–∞ (–º–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ)

## –ë—É–¥—É—â–∏–µ –£–ª—É—á—à–µ–Ω–∏—è

1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –°–æ—Å—Ç–æ—è–Ω–∏—è**: –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —à–∞–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É–ª—É –≤–º–µ—Å—Ç–æ —Å–∏–º—É–ª—è—Ü–∏–∏
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ edge (—Å TTL)
3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Ä–∞–∑—Ä—ã–≤–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ü–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: –†–∞–∑–Ω—ã–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–∞ —Ç–∏–ø —Å–µ—Å—Å–∏–∏
5. **–ò—Å—Ç–æ—Ä–∏—è –°–æ—Å—Ç–æ—è–Ω–∏—è**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–Ω–∏–º–∫–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è/–æ—Ç–ª–∞–¥–∫–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑:

1. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ**: –ö–ª–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π, –∞ –Ω–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —à–∫–∞–ª—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **–î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å –∫ edge**: –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ CDN edge –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±—ç–∫–µ–Ω–¥–∞
4. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: Stateless —Å–µ—Ä–≤–∏—Å—ã + —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

–î–∏–∑–∞–π–Ω —Ä–∞–∑–¥–µ–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –±—ç–∫–µ–Ω–¥ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, –∫–ª–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±—ç–∫–µ–Ω–¥.

