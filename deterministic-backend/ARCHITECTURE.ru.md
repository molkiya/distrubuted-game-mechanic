# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

> [üá¨üáß English version](ARCHITECTURE.md)

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å–µ—Å—Å–∏–π —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –≤—ã—á–∏—Å–ª—è—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Å–≤—è–∑–∏ —Å –±—ç–∫–µ–Ω–¥–æ–º.

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –±—ç–∫–µ–Ω–¥ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ç–∏–∫–æ–≤. –î–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–µ–π —Ç–∏–∫–æ–≤ —á–µ—Ä–µ–∑ AWS Lambda —Å–º. –æ—Å–Ω–æ–≤–Ω—É—é [ARCHITECTURE.ru.md](../ARCHITECTURE.ru.md).

## –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫

### –§—É–Ω–∫—Ü–∏—è –¥–≤–∏–∂–∫–∞

–°–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã ‚Äî —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è:

```go
func StateAt(seed int64, startAt time.Time, tickMs int64, now time.Time) State
```

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `seed`: –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ seed, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–µ–µ –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–∑—Ä—ã–≤–æ–≤
- `startAt`: –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏)
- `tickMs`: –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ç–∏–∫–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
- `now`: –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–í—ã—Ö–æ–¥:**
- `State` —Å –ø–æ–ª—è–º–∏:
  - `Step`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–æ–≤ —Å –Ω–∞—á–∞–ª–∞
  - `Value`: –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ)
  - `Round`: –ù–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞ (—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä—ã–≤–∞)
  - `Broken`: –ü—Ä–æ–∏–∑–æ—à—ë–ª –ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Ä–∞–∑—Ä—ã–≤

### –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞

**–ö–ª—é—á–µ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ**: –ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö `(seed, startAt, tickMs, now)` —Ñ—É–Ω–∫—Ü–∏—è **–≤—Å–µ–≥–¥–∞** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `State`.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–µ—Å—Å–∏–∏ –≤–∏–¥—è—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –¥–ª—è –ª—é–±–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏, –ø—Ä–æ—à–ª–æ–≥–æ –∏–ª–∏ –±—É–¥—É—â–µ–≥–æ

## –°–≤—è–∑—å —Å Tick Broadcaster

–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –≤ —ç—Ç–æ–º –±—ç–∫–µ–Ω–¥–µ ‚Äî **—Ç–æ—Ç –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º**, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ AWS Lambda tick-broadcaster (`/tick-broadcaster/src/engine.ts`):

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–æ–ª—å |
|-----------|------|
| –≠—Ç–æ—Ç –±—ç–∫–µ–Ω–¥ | –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ç–∏–∫–∞–º–∏ |
| Tick Broadcaster Lambda | –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Ç–∏–∫–æ–≤ |
| –ö–ª–∏–µ–Ω—Ç | –ü–æ–ª—É—á–∞–µ—Ç —Ç–∏–∫–∏ –æ—Ç Lambda –ò–õ–ò –≤—ã—á–∏—Å–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π) |

–û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- –ê–ª–≥–æ—Ä–∏—Ç–º xorshift64 PRNG
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Ä–∞–∑—Ä—ã–≤–∞
- –õ–æ–≥–∏–∫—É —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –º–µ—Å—Ç–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è.

## –ê–ª–≥–æ—Ä–∏—Ç–º

1. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —à–∞–≥–∞**:
   ```
   step = floor((now - startAt) / tickMs)
   ```
   –ï—Å–ª–∏ `now < startAt`, step = 0 (–¥–æ –Ω–∞—á–∞–ª–∞).

2. **–ü–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–∑—Ä—ã–≤–æ–≤**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç xorshift64 PRNG –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ä–∞–∑—Ä—ã–≤–∞: 100-300 —à–∞–≥–æ–≤ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞)
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ `(seed, round)` ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–°–∏–º—É–ª—è—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**:
   - –°–∏–º—É–ª–∏—Ä—É–µ—Ç –æ—Ç —à–∞–≥–∞ 0 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ä–∞–∑—Ä—ã–≤—ã
   - –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ: `Round++`, `Value = 0`, `Broken = true`
   - –ü–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞: –∑–Ω–∞—á–µ–Ω–∏–µ —Å–Ω–æ–≤–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

## API Endpoints

### POST /v1/sessions
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä–æ–≤—É—é —Å–µ—Å—Å–∏—é.

### GET /v1/sessions/{id}
–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Å—Å–∏–∏.

### POST /v1/sessions/{id}/stop
–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é.

## –•—Ä–∞–Ω–∏–ª–∏—â–µ

**Redis** (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):
- –ë—ã—Å—Ç—Ä—ã–π, –ø—Ä–æ—Å—Ç–æ–π, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TTL
- –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–∏–∫–æ–≤)

**–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞:
- Cassandra (–¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ, —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ–º–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞)
- DynamoDB (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å AWS Lambda)
- PostgreSQL

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –±—ç–∫–µ–Ω–¥

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –±—ç–∫–µ–Ω–¥ –∫–æ–≥–¥–∞:
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤, –≤—ã—á–∏—Å–ª—è—é—â–∏—Ö —Ç–∏–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ
- –ù—É–∂–µ–Ω –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏
- –†–∞–±–æ—Ç–∞–µ—Ç–µ –≤ —Å—Ä–µ–¥–∞—Ö –±–µ–∑ AWS Lambda

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Tick Broadcaster Lambda** –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∫–æ–≥–¥–∞:
- –ù—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
- –ò–≥—Ä–æ–∫–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–∫–æ–≤
- –•–æ—Ç–∏—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏

## –°–º. —Ç–∞–∫–∂–µ

- [–û—Å–Ω–æ–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](../ARCHITECTURE.ru.md) - –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —Å Lambda tick broadcasting
- [Tick Broadcaster](../tick-broadcaster/README.ru.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è AWS Lambda –º–∏–∫—Ä–æ–±—ç–∫–µ–Ω–¥–∞
